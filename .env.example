# =============================================================================
# DokTalk Environment Configuration Template
# =============================================================================
# Copy this file to .env and fill in your local values
# NEVER commit .env to version control
# =============================================================================

# -----------------------------------------------------------------------------
# Application
# -----------------------------------------------------------------------------
APP_NAME=DokTalk
APP_ENV=development
APP_DEBUG=true
APP_VERSION=1.0.0

# -----------------------------------------------------------------------------
# Backend API
# -----------------------------------------------------------------------------
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
API_RELOAD=true

# Secret key for JWT and session signing (generate with: openssl rand -hex 32)
SECRET_KEY=your-secret-key-here-change-in-production

# CORS origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# -----------------------------------------------------------------------------
# Frontend
# -----------------------------------------------------------------------------
NEXT_PUBLIC_API_URL=http://localhost:8000
NEXT_PUBLIC_WS_URL=ws://localhost:8000
NEXT_PUBLIC_APP_NAME=DokTalk

# -----------------------------------------------------------------------------
# Database (PostgreSQL 16)
# -----------------------------------------------------------------------------
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=doktalk
POSTGRES_USER=doktalk_user
POSTGRES_PASSWORD=change-this-password

# Database URL for SQLAlchemy
DATABASE_URL=postgresql+asyncpg://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# Connection pool settings
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# -----------------------------------------------------------------------------
# Redis (8.2.2+)
# -----------------------------------------------------------------------------
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=change-this-redis-password
REDIS_DB=0
REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}

# Redis ACL user (for application)
REDIS_APP_USER=doktalk_app
REDIS_APP_PASSWORD=change-this-app-password

# Cache TTL (seconds)
CACHE_DEFAULT_TTL=3600
CACHE_SESSION_TTL=86400

# -----------------------------------------------------------------------------
# Celery (Task Queue)
# -----------------------------------------------------------------------------
CELERY_BROKER_URL=${REDIS_URL}
CELERY_RESULT_BACKEND=${REDIS_URL}
CELERY_TASK_ALWAYS_EAGER=false
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json

# -----------------------------------------------------------------------------
# MinIO (Object Storage - WORM/SSE-KMS)
# -----------------------------------------------------------------------------
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin-change-this
MINIO_SECURE=false
MINIO_REGION=ru-central-1

# Bucket names
MINIO_BUCKET_MEDIA=doktalk-media
MINIO_BUCKET_EXPORTS=doktalk-exports
MINIO_BUCKET_BACKUPS=doktalk-backups

# Object Lock (WORM) - COMPLIANCE mode
MINIO_OBJECT_LOCK_ENABLED=true
MINIO_OBJECT_LOCK_MODE=COMPLIANCE
MINIO_RETENTION_DAYS=2555  # 7 years (323-FZ requirement)

# -----------------------------------------------------------------------------
# HashiCorp Vault (Secrets Management)
# -----------------------------------------------------------------------------
VAULT_ADDR=http://localhost:8200
VAULT_TOKEN=dev-only-token-change-in-production
VAULT_NAMESPACE=doktalk
VAULT_KV_PATH=secret/data/doktalk

# BYOK (Bring Your Own Key) per tenant
VAULT_TRANSIT_PATH=transit/doktalk

# -----------------------------------------------------------------------------
# WebRTC / Real-time Communication
# -----------------------------------------------------------------------------
# Jitsi Videobridge
JITSI_HOST=localhost
JITSI_PORT=8080
JITSI_DOMAIN=meet.doktalk.local

# TURN/STUN (coturn)
TURN_HOST=localhost
TURN_PORT=3478
TURN_USERNAME=doktalk
TURN_PASSWORD=change-this-turn-password
TURN_REALM=doktalk.local

STUN_HOST=localhost
STUN_PORT=3478

# -----------------------------------------------------------------------------
# ML/ASR Pipeline
# -----------------------------------------------------------------------------
# Whisper model size: tiny, base, small, medium, large
WHISPER_MODEL_SIZE=medium
WHISPER_MODEL_PATH=/models/whisper
WHISPER_DEVICE=cpu  # cpu or cuda
WHISPER_COMPUTE_TYPE=int8  # fp16, int8, int8_float16

# VAD (Voice Activity Detection)
VAD_MODEL_PATH=/models/silero_vad
VAD_THRESHOLD=0.5

# Diarization (pyannote)
PYANNOTE_MODEL_PATH=/models/pyannote
PYANNOTE_AUTH_TOKEN=your-huggingface-token-here

# Medical term post-editor
MEDICAL_TERM_DICT_PATH=/models/medical_terms_ru.json

# -----------------------------------------------------------------------------
# Observability
# -----------------------------------------------------------------------------
# OpenTelemetry
OTEL_ENABLED=true
OTEL_SERVICE_NAME=doktalk-api
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
OTEL_EXPORTER_OTLP_PROTOCOL=grpc

# Jaeger (Tracing)
JAEGER_AGENT_HOST=localhost
JAEGER_AGENT_PORT=6831

# Prometheus (Metrics)
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090

# Loki (Logs)
LOKI_URL=http://localhost:3100

# Grafana
GRAFANA_URL=http://localhost:3001
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=change-this-grafana-password

# -----------------------------------------------------------------------------
# Security & Compliance
# -----------------------------------------------------------------------------
# JWT
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# Password hashing
PASSWORD_HASH_ALGORITHM=bcrypt
PASSWORD_MIN_LENGTH=12

# Rate limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_BURST=10

# Session security
SESSION_COOKIE_SECURE=false  # Set to true in production (HTTPS only)
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=lax

# CSRF protection
CSRF_ENABLED=true

# -----------------------------------------------------------------------------
# Multi-tenancy
# -----------------------------------------------------------------------------
# Default tenant for development
DEFAULT_TENANT_ID=00000000-0000-0000-0000-000000000001
DEFAULT_TENANT_NAME=Development Clinic

# -----------------------------------------------------------------------------
# Compliance (RU)
# -----------------------------------------------------------------------------
# 152-FZ: Personal data localization
DATA_LOCALIZATION_COUNTRY=RU
DATA_RETENTION_YEARS=7  # 323-FZ requirement

# Audit logging
AUDIT_LOG_ENABLED=true
AUDIT_LOG_LEVEL=INFO
AUDIT_LOG_PII_ACCESS=true
AUDIT_LOG_HASH_CHAIN=true

# 965n: Telemedicine consent requirements
TELEMEDICINE_CONSENT_REQUIRED=true
TELEMEDICINE_RECORDING_RETENTION_DAYS=2555  # 7 years

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
FEATURE_SOAP_GENERATION=true
FEATURE_ICD10_SUGGESTIONS=true
FEATURE_ORDER_BLOCKS=true
FEATURE_PDF_EXPORT=true
FEATURE_EHR_COPY=true
FEATURE_VOICE_COMMANDS=false  # v2

# -----------------------------------------------------------------------------
# External Integrations
# -----------------------------------------------------------------------------
# EHR/IS integration endpoints (to be configured per deployment)
EHR_INTEGRATION_ENABLED=false
EHR_API_URL=https://ehr.example.com/api
EHR_API_KEY=your-ehr-api-key-here

# -----------------------------------------------------------------------------
# Development / Testing
# -----------------------------------------------------------------------------
# Seed data for development
SEED_DATA_ENABLED=true
SEED_DEMO_TENANTS=true
SEED_DEMO_USERS=true

# Testing
TEST_DATABASE_URL=postgresql+asyncpg://doktalk_test:test@localhost:5432/doktalk_test
PYTEST_WORKERS=auto

# E2E Testing
E2E_BASE_URL=http://localhost:3000
E2E_HEADLESS=true

# Load testing
K6_VUS=10  # Virtual users
K6_DURATION=30s
